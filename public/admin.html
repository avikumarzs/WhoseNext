<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Panel</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
</head>
<body>
    <header>
        <h1>‚öôÔ∏è Control Center</h1>
        <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Dark Mode">üåô</button>
    </header>

    <div class="dashboard-container">
        <div class="sidebar">
            <div style="background: var(--bg-main); padding: 1rem; border-radius: 8px; border: 1px solid var(--border);">
                <div class="input-group">
                    <label>Current Company</label>
                    <input type="text" id="companyInput" placeholder="Ex: Google">
                </div>
                <button class="btn-primary" style="padding: 0.5rem;" onclick="updateCompany()">Set Branding</button>
            </div>

            <hr style="border: 0; border-top: 1px solid var(--border);">

            <h3 style="color:var(--text-main);">Add Candidate</h3>
            <div class="input-group">
                <label>Name</label> <input type="text" id="name">
            </div>
            <div class="input-group">
                <label>Room Path</label> <input type="text" id="room" placeholder="203, 302, HR">
            </div>
            <button class="btn-primary" onclick="addStudent()">Add to Queue</button>
            
            <div style="margin-top: 1rem;">
                <label style="cursor: pointer; border: 2px dashed var(--border); padding: 0.8rem; border-radius: 8px; text-align: center; display: block; color: var(--text-muted); font-size: 0.8rem;">
                    üìÇ Upload Excel <input type="file" id="excelFile" accept=".xlsx" onchange="handleExcelUpload()" style="display: none;">
                </label>
            </div>
        </div>

        <div class="main-content">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>#</th> <th>Name</th> <th>Status</th> <th style="text-align: right;">Actions</th>
                    </tr>
                </thead>
                <tbody id="adminList"></tbody>
            </table>
        </div>
    </div>

    <script>
        // THEME LOGIC
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const icon = document.body.classList.contains('dark-mode') ? '‚òÄÔ∏è' : 'üåô';
            document.querySelector('.theme-toggle').innerText = icon;
        }

        // COMPANY LOGIC
        async function updateCompany() {
            const company = document.getElementById('companyInput').value;
            await fetch('/set-company', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ company }) });
            alert("Company Name Updated on Display Board!");
        }

        // QUEUE LOGIC (Same as before)
        async function loadQueue() {
            const res = await fetch('/get-queue');
            const data = await res.json();
            const list = document.getElementById('adminList');
            list.innerHTML = '';

            data.forEach((s, i) => {
                const currentRoom = s.path[s.currentStep];
                const isLast = s.currentStep >= s.path.length - 1;
                let btn = '';

                if (s.status === 'waiting') {
                    btn = `<button class="btn-call" onclick="sendAction(${i}, 'call')">üì¢ Call In</button>`;
                } else {
                    if (isLast) btn = `<button class="btn-done" onclick="sendAction(${i}, 'finish')">‚úì Finish</button>`;
                    else btn = `<button class="btn-primary" style="width:auto; padding:5px 10px;" onclick="sendAction(${i}, 'next')">‚ûù Send to ${s.path[s.currentStep+1]}</button>`;
                }

                list.innerHTML += `
                    <tr>
                        <td>${i+1}</td> <td style="font-weight:600;">${s.name}</td>
                        <td>${s.status === 'waiting' ? 'Waiting: ' + currentRoom : 'Inside: ' + currentRoom}</td>
                        <td style="text-align:right;">${btn} <button onclick="remove(${i})" style="background:none; border:none; cursor:pointer;">‚ùå</button></td>
                    </tr>`;
            });
        }
        
        async function addStudent() {
            const name = document.getElementById('name').value;
            const room = document.getElementById('room').value;
            if(name && room) {
                await fetch('/add-student', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ name, room }) });
                document.getElementById('name').value = ''; document.getElementById('room').value = ''; loadQueue();
            }
        }
        async function sendAction(i, action) { await fetch('/update-status', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ index: i, action }) }); loadQueue(); }
        async function remove(i) { await fetch(`/remove-student/${i}`, { method: 'DELETE' }); loadQueue(); }
        function handleExcelUpload() { /* (Keep your existing Excel logic here) */ }
        
        setInterval(loadQueue, 2000);
        loadQueue();
    </script>
</body>
</html>